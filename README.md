# DSA504 Wordpress Theme

### Dependencies
| Plugin | 
| ------ | 
| [Advanced Custom Fields Plugin](https://www.advancedcustomfields.com/) | 
| DSA504 Committee Custom Post Type Plugin (link coming soon) |

### Overview

This theme contains the the templates, CSS, js, and Wordpress customizations for the new, WP-based DSA504 site. 

### Stuff to know

- **Content Types** 
 Out of box, Wordpress has two content types: posts and pages. Via the DSA504 Committee plugin, we've added another post type, Committees. Wordpress has a [cascading system](https://developer.wordpress.org/themes/basics/template-hierarchy/) to decide which tempate to use for which content type- more or less like:
  - *single-{post-type}-{slug}.php* – First, WordPress looks for a template for the specific post (you can see/edit the slug in the WP backend).
  - *single-{post-type}.php* – If the post type is product, WordPress would look for single-product.php.
  - *single.php* – WordPress then falls back to single.php.
  - *index.php* – Finally, as mentioned above, WordPress ultimately falls back to index.php.

  Currently, pretty much everything is falling back to index.php, except for single-committee.php (see more below).
- **Advanced Custom Fields (ACF)**
  This theme uses ACF pretty extensively. In a generic Wordpress install, when users are editing posts and pages via the WP backend, they're shown the Wordpress-default fields for that post type. These fields are pretty bare-bones- title, content, and a few other options. ACF lets us set rules to easily add new fields (or hide default fields), giving us flexible, granual control of what author/editor users can see and change. A couple examples of how this works:

  *Example: Committee Fields* 
  With our DSA504 Committee plugin, we created a new post type, "Committee", which inherits all the normal properties of the "post" type. We've created an ACF field group for this post type (in the WP backend with an admin account, go to Custom Fields->Fields Groups->Committee Fields->Edit.) If you look at the "Rules" section, you can see we've limited this field group to "post type = committee".
  
  As the Committee type is a "post"-type post, by default, in the WP editor we'd get all the normal post fields. Instead, via ACF we've hidden the default fields ("Hide on Screen" section) and added three new fields (Introductory Text, Contact Email, and Resources) of types WYSIWYG, Text, and WYSIWYG, respectively. You can go to Committees->All Committees->Edit to see that now those are the editable fields for that post type.
  
  In the template for committees (single-committee.php), you can see how we can get that inputted data in a template, using `get_field()`:
  ```
    <div class="intro-section-body"><?php echo get_field('introductory_text');?></div>
	<?php if(get_field('resources_text')!=""){ ?>
	    <div class="intro-section-header">Resources</div>
    	<div class="intro-section-body"><?php echo get_field('resources_text');?></div>
	<?php }; ?>
  ```
  *Example: Posts By Committee Fields* 
  We join each post to a committee by using a relational type. We've added a field group for "post type = posts", and then added a relational field named "committee", and limited the selectable posts to "committee" types. Looking at a post in the WP backend, you'll see there's an option to select a committee to tie it to. 
  
  Now, we can query using the default wordpress `get_posts()` to fetch all posts that match a particular committee (again from single-committee.php):
  ```
  // get the posts connected to this committee by their committee acf field
  $posts = get_posts(array(
		'post_type' => 'post',
		'meta_query' => array(
    		array(
				'key' => 'committee', 
				'value' => '"' . get_the_ID() . '"',
				'compare' => 'LIKE'
				)
			)
	));
    ```

### Files/folders:
* *acf-json/*  
   Folder generated by ACF to locally backup field groups. Probably don't mess with this.
* *addons/*
  Contains reusuable php chunks to stick in templates- ex. the sidebar calendar (calendar-simple.php) and signup form (cta-box.php) 
* *library/*
   - *dsa504.php*
  Called by functions.php, atm does some Wordpress-specific housecleaning, removing unneccessary  out-of-box Wordpress cruff from the <head>, enqueing scripts, etc.     
  - *css/*
    The style.css in here is the Sass-generated primary stylesheet for the entire site
  - *fonts/*
    Fonts, duh
  - *images/*
    Header and footer logos, and a few other images "hardcoded" in the templates- however keep in mind all images user-uploaded through the WP backend are stored by wordpress in the root, at /wp-content/uploads
  - *js/*
   scripts.js is the sitewide script; events.js is for the calendar.
  - *scss/*
   Holds all the [Sass](http://sass-lang.com/) files which are compiled into the final style.css (stored in library/css/) used sitewide. There's a million ways to compile Sass, but I use [Koala](http://koala-app.com/), because I'm lazy and non-l33t. 
**style.scss** will be the file you'll want to compile (output to **library/css/style.css**). It contains imports for the width-specific sass files (breakpoints/), buttons and forms (modules/) and style normalization (partials/). In practice the bulk of the styles are in /breakpoints/_base.scss.
- *functions.php*
 This is where the bulk of the theme php heavy-lifting would go, if we were doing anything. atm it really just calls library/dsa504.php, and adds the "DSA504 Theme Settings" menu item to the admin (the actual user-changeable options are setup via ACF). 
- *header.php*, *footer.php*, & *sidebar.php*
  Sitewide templates for the <head> and header/menu, the footer, and the sidebar, repectively.
- *index.php*
  Right now this is the default, fallback template for basically everything.

### Resources:
- [ACF Documentation](https://www.advancedcustomfields.com/resources/)
- [Wordpress Codex](https://codex.wordpress.org/Theme_Development)
- [Sass Documentation](http://sass-lang.com/documentation/file.SASS_REFERENCE.html)

Question, comments, or complaints? Hit me up (@trey) on the slack.



